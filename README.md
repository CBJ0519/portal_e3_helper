# NYCU E3 Helper

優化陽明交通大學 E3 學習平台的使用體驗。

## 功能特色

### ✅ 已實作功能

#### 1. 📱 側邊欄助手
- **浮動按鈕**：任何網頁都能快速開啟側邊欄
- **響應式設計**：美觀的漸層介面，支援滑動展開/收合
- **多分頁切換**：作業、公告、成績一目了然
- **跨網頁使用**：不限於 E3 網站，任何網頁都能使用

#### 2. 📝 作業倒數與管理
- **即時倒數**：顯示作業截止時間倒數（天/小時/分鐘）
- **狀態標記**：手動標記作業為「已繳交」或「待處理」
- **視覺化提示**：
  - 🔴 已逾期（紅色）
  - 🟡 即將到期（黃色，3 天內）
  - 🟢 充裕時間（綠色）
- **快速連結**：點擊作業直接進入繳交頁面
- **課程顯示**：自動顯示作業所屬課程名稱
- **自動保留**：已標記為「已繳交」的作業不會被自動刪除

#### 3. 📢 公告與信件整合
- **公告聚合**：整合所有課程的最新公告
- **信件整合**：支援 dcpcmail 系統的課程信件
- **統一介面**：公告與信件合併顯示，方便管理
- **篩選功能**：
  - 按類型：全部/公告/信件
  - 按狀態：全部/未讀/已讀
- **詳細預覽**：點擊查看完整內容
- **已讀追蹤**：自動記錄已讀狀態
- **新分頁開啟**：預覽中的連結自動在新分頁開啟

#### 4. 📊 成績查詢
- **快速查詢**：一鍵查看所有課程成績
- **詳細資訊**：
  - 作業成績與比重
  - 考試成績與比重
  - 總成績計算
- **視覺化呈現**：清楚的分數顯示與百分比
- **即時更新**：支援手動重新載入

#### 5. 📥 快速下載教材
- **批次下載**：一鍵下載課程所有檔案
- **ZIP 打包**：自動打包成 ZIP 檔案
- **自動命名**：檔案名稱包含課程名稱
- **進度提示**：下載過程中顯示進度

#### 6. 🔄 自動同步功能
- **背景同步**：每小時自動同步一次
- **手動同步**：點擊按鈕立即同步
- **同步內容**：
  - 作業列表與截止時間
  - 課程列表
  - 公告與信件（手動）
- **同步狀態**：顯示最後同步時間
- **登入檢查**：自動檢測登入狀態
- **錯誤處理**：網路錯誤時友好提示

#### 7. 🎯 一鍵前往作業
- **快速按鈕**：在 E3 頁面的作業旁新增「📝 前往作業」按鈕
- **直接進入**：點擊直接進入作業繳交頁面，跳過日曆頁面
- **支援位置**：
  - ✅ 首頁時間軸
  - ✅ 日曆頁面
  - ✅ 通知中心
  - ✅ 課程總覽
- **動態監聽**：自動偵測新增的作業元素

## 截圖

### 側邊欄介面
```
┌─────────────────────┐
│  📚 作業 📢 公告 📊 成績 │
├─────────────────────┤
│  🔴 DSA HW (F)      │
│  📘 資料結構與演算法  │
│  ⏰ 還有 2 天 3 小時 │
│  [📝 前往] [✓ 已繳交] │
├─────────────────────┤
│  🟡 期末書面報告     │
│  📗 人文與科學經典   │
│  ⏰ 還有 5 天       │
│  [📝 前往] [⏸ 待處理]│
├─────────────────────┤
│  🔄 同步  ✓ 5分鐘前  │
└─────────────────────┘
```

## 安裝方式

### Chrome / Edge / Brave

1. **下載專案**
   ```bash
   git clone https://github.com/CBJ0519/portal_e3_helper.git
   cd portal_e3_helper
   ```

2. **載入擴充功能**
   - 開啟瀏覽器，進入擴充功能管理頁面
     - Chrome: `chrome://extensions/`
     - Edge: `edge://extensions/`
     - Brave: `brave://extensions/`
   - 開啟右上角「開發人員模式」
   - 點擊「載入未封裝項目」
   - 選擇專案資料夾
   - 完成！

3. **驗證安裝**
   - 開啟任何網頁
   - 應該會看到右側浮動的「📚 E3小助手」按鈕
   - 點擊按鈕開啟側邊欄

## 使用指南

### 首次使用

1. **登入 E3**
   - 訪問 https://e3p.nycu.edu.tw/
   - 使用學號密碼登入

2. **首次同步**
   - 點擊側邊欄中的「🔄 同步」按鈕
   - 等待同步完成（約 10-30 秒）
   - 同步內容包括：作業、課程列表

3. **開始使用**
   - 切換到「📝 作業」分頁查看作業倒數
   - 點擊「📢 公告」分頁查看公告與信件
   - 點擊「📊 成績」分頁查詢成績

### 日常使用

#### 查看作業
- 開啟側邊欄 → 作業分頁
- 查看作業截止時間倒數
- 點擊「前往」按鈕進入作業頁面
- 完成作業後點擊「已繳交」標記

#### 查看公告與信件
- 開啟側邊欄 → 公告分頁
- 點擊「載入公告」或「載入信件」按鈕
- 使用篩選功能（類型/狀態）
- 點擊「查看內容」查看詳細資訊

#### 查詢成績
- 開啟側邊欄 → 成績分頁
- 選擇要查詢的課程
- 點擊「查詢成績」
- 查看作業、考試、總成績

#### 下載教材
- 前往 E3 課程頁面
- 開啟側邊欄
- 點擊「📥 下載教材」按鈕
- 等待打包完成並自動下載

### 進階技巧

#### 自動同步設定
- 擴充功能會每小時自動同步一次
- 可隨時點擊「🔄 同步」手動同步
- 同步狀態會顯示在側邊欄底部

#### 作業狀態管理
- 「待處理」：預設狀態，顯示在作業列表中
- 「已繳交」：手動標記，過期後仍保留在列表中
- 「已逾期」：自動標記，顯示紅色警告

## 技術細節

### 專案結構

```
e3_helper/
├── manifest.json      # Chrome Extension 配置（Manifest V3）
├── background.js      # Service Worker（背景同步）
├── content.js         # 內容腳本（核心功能）
├── jszip.min.js       # ZIP 打包函式庫
├── README.md          # 說明文件
├── DEBUG.md           # 除錯指南
├── INSTALL.md         # 安裝說明
└── .gitignore         # Git 忽略規則
```

### 技術架構

#### Manifest V3
- Service Worker 架構
- 非持久性背景頁面
- 支援 Chrome 88+

#### 資料同步
- 使用 Moodle REST API
- 背景定時同步（Alarms API）
- 本地儲存（Storage API）

#### 作業管理
- API: `core_calendar_get_action_events_by_timesort`
- 自動提取課程名稱
- 保留已繳交作業資料

#### 公告與信件
- 公告: Moodle Forum API
- 信件: dcpcmail 系統 HTML 解析
- 合併顯示與篩選

#### 成績查詢
- HTML 解析成績頁面
- 提取作業、考試、總成績
- 計算百分比與比重

### API 使用

#### 取得作業列表
```javascript
POST https://e3p.nycu.edu.tw/lib/ajax/service.php?sesskey={sesskey}
{
  "methodname": "core_calendar_get_action_events_by_timesort",
  "args": {
    "limitnum": 50,
    "timesortfrom": timestamp,
    "timesortto": timestamp
  }
}
```

#### 取得課程列表
```javascript
POST https://e3p.nycu.edu.tw/lib/ajax/service.php?sesskey={sesskey}
{
  "methodname": "core_course_get_enrolled_courses_by_timeline_classification",
  "args": {
    "classification": "inprogress"
  }
}
```

## 隱私權

- ✅ 不收集任何個人資料
- ✅ 不追蹤使用者行為
- ✅ 所有資料僅儲存在本地瀏覽器
- ✅ 不連接任何第三方伺服器
- ✅ 開源程式碼，可自行審查

## 常見問題

### Q: 為什麼同步失敗？

A: 可能原因：
1. **未登入 E3**：請先登入 https://e3p.nycu.edu.tw/
2. **網路問題**：檢查網路連線
3. **Session 過期**：重新登入 E3 後再同步

解決方法：開啟 Service Worker Console 查看詳細錯誤訊息

### Q: 作業沒有顯示課程名稱？

A: 擴充功能會自動從 API 獲取課程名稱，如果仍顯示「(未知課程)」：
1. 點擊「🔄 同步」重新同步
2. 檢查 Service Worker Console 是否有錯誤訊息

### Q: 擴充功能重新載入後無法使用？

A: 這是正常現象。當擴充功能更新時：
1. 會自動顯示「擴充功能已更新」警告
2. 點擊「重新整理頁面」按鈕即可

### Q: 公告或信件載入很慢？

A: 公告與信件需要逐一抓取每個課程的資料，可能需要 10-30 秒。載入過程中：
- 顯示「載入中...」提示
- 可查看 Console 了解進度

### Q: 下載的 ZIP 檔案無法開啟？

A: 可能原因：
1. 下載過程中斷
2. 課程檔案過大（超過 500MB）
3. 瀏覽器限制

解決方法：
1. 重新下載
2. 檢查網路連線
3. 手動下載大型檔案

## 開發與除錯

### 除錯模式

1. **開啟 Console**
   - 按 F12 開啟開發者工具
   - 切換到 Console 分頁
   - 查看 `E3 Helper:` 開頭的訊息

2. **Service Worker Console**
   - 訪問 `chrome://extensions/`
   - 找到 NYCU E3 Helper
   - 點擊「Service Worker」→「檢查檢視」
   - 查看背景同步的 log

3. **Storage 檢視**
   - F12 → Application → Storage → Extension Storage
   - 查看 `assignments`、`courses`、`announcements` 等資料

### 常用除錯指令

```javascript
// 查看作業資料
chrome.storage.local.get(['assignments'], console.log)

// 查看課程列表
chrome.storage.local.get(['courses'], console.log)

// 查看同步狀態
chrome.storage.local.get(['lastSync'], console.log)

// 手動觸發同步（在 Service Worker Console）
syncE3Data()
```

## 貢獻

歡迎提交 Issue 和 Pull Request！

### 開發環境設定
```bash
git clone https://github.com/CBJ0519/portal_e3_helper.git
cd portal_e3_helper
# 在 Chrome 中載入擴充功能
```

### 提交 PR 前
1. 確保程式碼正常運作
2. 測試所有功能
3. 遵循現有程式碼風格
4. 提供清楚的 commit 訊息

## 更新日誌

### v1.1 (2025-01-17)
- ✨ 新增側邊欄介面，支援跨網頁使用
- ✨ 新增作業倒數與狀態管理功能
- ✨ 新增公告與信件整合（支援 dcpcmail）
- ✨ 新增成績查詢功能
- ✨ 新增快速下載教材功能
- ✨ 新增自動同步功能（每小時）
- 🐛 修復作業課程名稱顯示問題
- 🐛 修復 Extension Context Invalidated 錯誤
- 🎨 改進 UI/UX 設計，更加美觀易用

### v1.0 (2025-01-14)
- ✨ 新增一鍵前往作業按鈕
- ✨ 支援動態載入的內容（MutationObserver）
- ✨ 紫色漸層按鈕設計

## 授權

MIT License

## 聯絡方式

- GitHub: https://github.com/CBJ0519/portal_e3_helper
- Issues: https://github.com/CBJ0519/portal_e3_helper/issues
